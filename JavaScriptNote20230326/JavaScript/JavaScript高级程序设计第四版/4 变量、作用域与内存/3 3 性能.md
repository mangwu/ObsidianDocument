# 3.3 性能

垃圾回收的**时间调度**会影响JavaScript的性能

# 垃圾回收与性能

- 垃圾回收程序会周期性运行，如果时间调度不好会造成JavaScript的性能损耗
    - 例如内存中分配了很多变量，但是垃圾回收周期过长，导致无用变量过多，运行变慢
- 垃圾回收差的时间调度会导致
    - **拖慢浏览器渲染速度**
    - **拖慢帧速率**

# 不同引擎的垃圾回收时间调度

## V8引擎

> “在一次完整的垃圾回收后，V8的**堆增长策略**会根据**活跃对象的数量外加一些余量**来确定何时再次垃圾回收。“
> 

## IE

- IE的时间调度策略曾饱受诟病

### IE7之前

- 根据分配数阈值来运行垃圾回收程序
- 例如分配了256个变量、4096个对象/数组字面量和数组槽位（slot），或者64KB字符串
    - 其中一个条件满足就会运行垃圾回收程序
    - 问题在于有些脚本可能在其生命周期内始终需要这么多的变量
    - 导致垃圾回收程序过于频繁运行，对性能造成严重影响

### IE7及之后

- **动态改变分配数阈值**
- 分配变量、字面量、数组槽位初始时的阈值和IE6相同
- 进行过一次垃圾回收的内存占比不到已分配15%，就会将上述的阈值翻倍
- 如果一次回收的内存占比超过已分配的85%，就会将上述阈值恢复到初始值

## 注意

- 一些浏览器中有主动除法垃圾回收的方法
- IE中，`window.CollectGarbage()`方法会立刻执行垃圾回收
- Opera7及更高版本，调用`window.opera.collect()` 方法也会启动垃圾回收程序