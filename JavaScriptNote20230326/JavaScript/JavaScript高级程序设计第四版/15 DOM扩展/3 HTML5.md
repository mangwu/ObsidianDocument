# 3. HTML5

- åœ¨HTML5ä¹‹å‰ï¼ŒHTMLï¼ˆè¶…æ–‡æœ¬æ ‡è®°è¯­è¨€â€”â€”HyperText Markup Languageï¼‰ä»…ä½œä¸ºä¸€ä¸ª**çº¯æ ‡è®°è¯­è¨€**ï¼Œä¸ä¼šåŒ…å«å…³äºJavaScriptç›¸åŒçš„äº‹æƒ…ï¼Œè¿™äº›äº‹æƒ…éƒ½äº¤ç»™DOMè§„èŒƒå»å®šä¹‰
- HTML5ä»£è¡¨ç€ä¸ä»¥å‰çš„HTMLæˆªç„¶ä¸åŒçš„æ–¹å‘ï¼ŒHTML5è§„èŒƒåŒ…å«äº†ä¸æ ‡è®°ç›¸å…³çš„å¤§é‡JavaScript APIå®šä¹‰ï¼Œå…¶ä¸­æœ‰çš„APIä¸DOMé‡åˆï¼Œå®šä¹‰äº†æµè§ˆå™¨åº”è¯¥æä¾›çš„DOMæ‰©å±•
    
    <aside>
    ğŸ’¡ HTML5è¦†ç›–çš„èŒƒå›´æå…¶å¹¿æ³›ï¼Œæœ¬èŠ‚ä»…è®¨è®ºå…¶å½±å“DOMèŠ‚ç‚¹çš„éƒ¨åˆ†
    
    </aside>
    
- HTML5æ˜¯ä¹‹å‰HTMLç‰ˆæœ¬çš„ç»§æ‰¿è€…ï¼Œåœ¨ä¹‹å‰ç‰ˆæœ¬HTML 4.01çš„åŸºç¡€ä¸Šå¼•å…¥äº†æ–°çš„å…ƒç´ å’ŒåŠŸèƒ½ï¼Œå¹¶æ”¹è¿›æˆ–åˆ é™¤äº†ä¸€äº›ç°æœ‰çš„åŠŸèƒ½
    - HTML5æœ€æ–°æ ‡å‡†å¯ä»¥æŸ¥çœ‹**[w3c**-**HTML5**](http://www.w3.org/TR/html5/) ï¼Œw3cä¸ºå®ƒåšäº†ä¸€ä¸ªå•ç‹¬çš„åŸŸåç½‘ç«™ï¼ˆ[html.spec.whatwg.org](http://html.spec.whatwg.org/)ï¼‰è€Œä¸æ˜¯w3cçš„åŸŸå
    - MDNè§£é‡Šï¼šç›´åˆ°2019å¹´ï¼ŒW3Cå‘å¸ƒäº†ä¸€ä¸ªä¸HTML5ç«äº‰çš„å¸¦æœ‰ç‰ˆæœ¬å·çš„ï¼ˆHTMLï¼‰æ ‡å‡†ã€‚è‡ª2019å¹´5æœˆ28æ—¥èµ·ï¼Œ**WHATWGä½¿ç”¨æ ‡å‡†**ï¼ˆ**WHATWG Living Standard**ï¼‰è¢«W3Cå®£å¸ƒä¸ºå”¯ä¸€çš„HTMLç‰ˆæœ¬ã€‚
        - WHATWGæ˜¯è‹¹æœï¼ˆAppleï¼‰ï¼Œè°·æ­Œï¼ˆGoogleï¼‰ï¼Œè°‹æ™ºï¼ˆMozillaï¼‰ï¼Œå¾®è½¯ï¼ˆMicrosoftï¼‰ç»„æˆçš„ä¸€ä¸ªç»„ç»‡ï¼Œè¯¥ç»„ç»‡å…¨åç§°ä¸º**Web Hypertext Application Technology Working Group â€”â€”**ç½‘é¡µè¶…æ–‡æœ¬åº”ç”¨æŠ€æœ¯å·¥ä½œå°ç»„ï¼Œèµ·åˆæ˜¯ä¸€ä¸ªä»¥æ¨åŠ¨ç½‘ç»œ[HTML 5](https://baike.baidu.com/item/HTML%205/8762673?fromModule=lemma_inlink)æ ‡å‡†ä¸ºç›®çš„è€Œæˆç«‹çš„ç»„ç»‡
        - ç°åœ¨åœ¨w3.orgæ ‡å‡†ç»„ç»‡ç½‘ç«™æœç´¢HTMLï¼Œå¯ä»¥çœ‹å¤§æœ€æ–°çš„æ ‡å‡†ç‰ˆæœ¬æ˜¯[HTML5.3](https://www.w3.org/TR/2021/NOTE-html53-20210128/) ï¼Œå®ƒç›®å‰å°±æ˜¯ä¸Šé¢æ‰€è¯´çš„[html.spec.whatwg.org](http://html.spec.whatwg.org/)

# 3.1 CSSç±»æ‰©å±•ï¼ˆClass-Related Additionsï¼‰

- è‡ªHTML4è¢«å¹¿æ³›é‡‡ç”¨ä»¥æ¥ï¼ŒWebå¼€å‘ä¸­ä¸€ä¸ªä¸»è¦å˜åŒ–æ˜¯classå±æ€§ç”¨çš„è¶Šæ¥è¶Šå¤šï¼Œå…¶ç”¨å¤„æ˜¯ä¸ºå…ƒç´ **æ·»åŠ æ ·å¼ä»¥åŠè¯­ä¹‰ä¿¡æ¯**
- JavaScriptå…³äºCSSç±»çš„**äº¤äº’**ä¹Ÿå°±è¶Šæ¥è¶Šå¤šï¼ŒåŒ…æ‹¬åŠ¨æ€ä¿®æ”¹ç±»åï¼ˆclassNameï¼‰ï¼Œä»¥åŠæ ¹æ®ç»™å®šçš„ä¸€ä¸ªæˆ–ä¸€ç»„ç±»åæŸ¥è¯¢å…ƒç´ ï¼ˆSelector APIï¼‰ç­‰
- HTML5ä¸ºäº†é€‚åº”å¼€å‘è€…å¯¹classå±æ€§çš„ä½¿ç”¨ï¼Œå¢åŠ äº†ä¸€äº›ç‰¹æ€§ä»¥æ–¹ä¾¿ä½¿ç”¨CSSç±»å‹

## 3.1.1 getElementsByClassName()

- `getElementsByClassName()` æ–¹æ³•åŸºäºåŸæœ‰DOMç‰¹æ€§å®ç°è¯¥åŠŸèƒ½çš„JavaScriptåº“ï¼Œæä¾›äº†æ€§èƒ½é«˜å¥½çš„åŸç”Ÿå®ç°
    - æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç±»åçš„å­—ç¬¦ä¸²ï¼Œè¿”å›ç±»åä¸­åŒ…å«ç›¸åº”ç±»çš„å…ƒç´ çš„`[HTMLCollection](https://dom.spec.whatwg.org/#htmlcollection)` ï¼ˆã€ŠJavaScripté«˜çº§ç¨‹åºè®¾è®¡ï¼ˆç¬¬4ç‰ˆï¼‰ã€‹ä¸Šå†™çš„`NodeList` ï¼Œå®é™…ä¸Šåº”è¯¥æ˜¯HTMLCollectionï¼‰
    - å¤šä¸ªç±»åçš„é¡ºåºæ˜¯æ— å…³ç´§è¦çš„ï¼Œå®ƒä»¬ä¹‹é—´ç”¨ç©ºæ ¼åˆ†éš”ï¼ŒæŸ¥è¯¢çš„å…ƒç´ èŠ‚ç‚¹çš„ç±»åç§°èƒ½åŒ¹é…æ‰€æœ‰ç±»å
    - è¿™ä¸ªæ–¹æ³•åœ¨`Node` æ¥å£ä¸­å®šä¹‰ï¼Œæ‰€ä»¥Documentï¼ŒElementç±»å‹éƒ½å®ç°äº†ï¼Œå®ƒåªä¼šè¿”å›ä»¥è°ƒç”¨å®ƒçš„å¯¹è±¡ä¸ºæ ¹å…ƒç´ çš„å­æ ‘ä¸­æ‰€åŒ¹é…çš„å…ƒç´ 
    - IE9ç‰ˆæœ¬åŠä»¥ä¸Šï¼Œä»¥åŠæ‰€æœ‰ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒ`getElementsByClassName()`æ–¹æ³•
    
    ```jsx
    <body>
      <div class="a b c d">
        <p class="a b c">abc</p>
        <p class="a b d">abd</p>
        <p class="c b d">bcd</p>
        <p class="a c d">acd</p>
      </div>
      <div class="c d b">
        cdb
        <span class="b a d"> bad </span>
        <p class="a c d">acd</p>
      </div>
      <script>
        const ads = document.getElementsByClassName("a d");
        console.log(ads);
        const abcd = document.getElementsByClassName("a b c d")[0];
        const bcs = abcd.getElementsByClassName("b c");
        console.log(bcs);
      </script>
    </body>
    ```
    
    ![getElementsByClassName.png](3%20HTML5/getElementsByClassName.png)
    

## 3.1.2 classListå±æ€§

- ä¸€ä¸ªå…ƒç´ èŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªç±»åç§°ï¼Œåœ¨HTMLä¸­ï¼Œç±»åä½¿ç”¨è‡³å°‘ä¸€ä¸ªç©ºæ ¼åˆ†éš”å¼€ï¼Œæ‰€ä»¥æ²¡æœ‰`classList`å±æ€§å‰ï¼Œå¯ä»¥æ“ä½œ`className` å±æ€§å€¼è·å–æ¯ä¸ªç±»åï¼Œç„¶åè¿›è¡Œå¢åˆ æ”¹æŸ¥ï¼Œæ¯”å¦‚
    
    ```jsx
    <div class="a b c"></div>
    <script>
      const div = document.querySelector("div");
      const classNames = div.className.split(/\s+/);
      // æ‰¾åˆ°æƒ³è¦ä¿®æ”¹çš„ç±»å
      let idx = classNames.indexOf("b");
      if (idx !== -1) classNames.splice(idx, 1, "d"); // ä¿®æ”¹æˆæƒ³è¦çš„ç±»å
      div.className = classNames.join(" "); // æœ€ådivç±»åå˜æˆä¹a d c
    </script>
    ```
    
- åˆ é™¤ç±»åã€å¢åŠ ç±»åä¹Ÿä¼šæœ‰ç±»ä¼¼çš„å…ˆåˆ†éš”è·å–æ‰€æœ‰ç±»åï¼Œæ“ä½œåé‡æ–°åˆå¹¶çš„ç®—æ³•ï¼Œå¾ˆå¤šJavaScriptåº“ä¸ºè¿™äº›æ“ä½œå®ç°ä¹ä¾¿åˆ©çš„æ–¹æ³•
- HTML5é€šè¿‡ç»™æ‰€æœ‰å…ƒç´ å¢åŠ `classList`å±æ€§ä¸ºè¿™äº›æ“ä½œæä¾›äº†æ›´ç®€å•ä¹Ÿæ›´å®‰å…¨çš„å®ç°æ–¹å¼ï¼Œ`classList` å®šä¹‰åœ¨`Node` æ¥å£ï¼Œå®ƒæœ¬èº«å¹¶ä¸æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè€Œæ˜¯ä¸€ä¸ª`[DOMTokenList`](https://dom.spec.whatwg.org/#domtokenlist) ç±»å‹ï¼Œå…¶æ¥å£å®šä¹‰å¦‚ä¸‹
    
    ```jsx
    [Exposed=Window]
    interface DOMTokenList {
      readonly attribute unsigned long length;
      getter DOMString? item(unsigned long index);
      boolean contains(DOMString token);
      [CEReactions] undefined add(DOMString... tokens);
      [CEReactions] undefined remove(DOMString... tokens);
      [CEReactions] boolean toggle(DOMString token, optional boolean force);
      [CEReactions] boolean replace(DOMString token, DOMString newToken);
      boolean supports(DOMString token);
      [CEReactions] stringifier attribute DOMString value;
      iterable<DOMString>;
    };
    ```
    
    - [ ]  `length` ï¼šè¡¨ç¤ºåŒ…å«å¤šå°‘é¡¹ï¼Œåœ¨`classList` å±æ€§ä¸­å°±æ˜¯èŠ‚ç‚¹çš„ç±»åä¸ªæ•°
    - [ ]  `item(index)` ï¼š`getter` æ–¹æ³•ï¼Œä¼ å…¥ç´¢å¼•æ•°å­—è·å–å¯¹åº”çš„ç±»åï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸­æ‹¬å·è¯­æ³•ï¼Œç±»åçš„é¡ºåºå°±æ˜¯`className` å­—ç¬¦ä¸²ä»¥ç©ºæ ¼åˆ†å‰²åçš„é¡ºåº
    - [ ]  `add(value)` ï¼šå‘ç±»ååˆ—è¡¨ä¸­æ·»åŠ æŒ‡å®šçš„å­—ç¬¦ä¸²å€¼`value` ï¼Œä¼šåŠ åœ¨åˆ—è¡¨æœ€åï¼ˆä¹Ÿå°±æ˜¯`className`å­—ç¬¦ä¸²æœ€åï¼‰ï¼Œå¦‚æœåˆ—è¡¨ä¸­å­˜åœ¨åŒåç±»åï¼Œå°±ä¸ä¼šåšä»»ä½•äº‹æƒ…
    - [ ]  `contains(value)` ï¼šè¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºç»™å®šçš„`value` æ˜¯å¦å­˜åœ¨
    - [ ]  `remove(value)` ï¼šä»ç±»ååˆ—è¡¨ä¸­åˆ é™¤æŒ‡å®šçš„å­—ç¬¦ä¸²å€¼`value` ï¼Œå¦‚æœæ²¡æœ‰å°±ä¸ä¼šåšä»»ä½•äº‹æƒ…
    - [ ]  `toggle(token[, force])` ï¼šå¦‚æœ`force` ä¸º`false` æˆ–è€…æ²¡æœ‰ä¼ é€’ï¼Œé‚£ä¹ˆä¼šè¿›è¡Œâ€œ**åˆ‡æ¢ï¼ˆtoggleï¼‰**â€æ“ä½œï¼Œå³ç±»ååˆ—è¡¨ä¸­å·²ç»å­˜åœ¨æŒ‡å®šçš„`token` å°±åˆ é™¤ä¹‹å¹¶è¿”å›`false`ï¼Œä¸å­˜åœ¨ï¼Œåˆ™æ·»åŠ ä¹‹å¹¶è¿”å›`true`ï¼›å¦‚æœ`force` ä¸º`true` ï¼Œåˆ™ä¼šè¿›è¡Œå¼ºåˆ¶æ·»åŠ ï¼ˆæœ‰é‡å¤å°±ä¸æ·»åŠ ï¼‰æ“ä½œå¹¶è¿”å›`true`
    - [ ]  `repalce(token, newToken)` ï¼šä½¿ç”¨`newToken`æ›¿æ¢å·²å­˜åœ¨çš„`token` ï¼Œå¦‚æœ`token` åœ¨ç±»åˆ—è¡¨ä¸­å·²å­˜åœ¨ï¼Œä¼šæˆåŠŸæ›¿æ¢å¹¶è¿”å›`true` ï¼Œå¦åˆ™ä¸èƒ½æˆåŠŸæ›¿æ¢ï¼Œä¸è¿›è¡Œå…¶ä»–æ“ä½œï¼Œè¿”å›`false`
    - [ ]  `value` ï¼šç­‰äºèŠ‚ç‚¹çš„`className`
- IE10åŠä»¥ä¸Šç‰ˆæœ¬ï¼ˆéƒ¨åˆ†ï¼‰å’Œå…¶ä»–ä¸»æµæµè§ˆå™¨ï¼ˆå®Œå…¨ï¼‰å®ç°äº†`classList`å±æ€§
    
    ```jsx
    <body>
      <p class="a b c d"></p>
      <script>
        const p = document.querySelector("p");
        console.log(p.classList.toggle("a")); // åˆ é™¤ä¹‹ï¼Œè¿”å›false
        console.log(p.classList.toggle("e")); // æ·»åŠ ä¹‹ï¼Œè¿”å›true
    
        console.log(p.classList.toggle("b", true)); // å¼ºåˆ¶é‡å¤æ·»åŠ ï¼Œè¿”å›true
        console.log(p.classList.toggle("f", true)); // å¼ºåˆ¶æ·»åŠ ï¼Œè¿”å›true
    
        console.log(p.classList.contains("c")); // true
        console.log(p.classList.replace("c", "a")); // true
      </script>
    </body>
    // æœ€ç»ˆpèŠ‚ç‚¹çš„ç±»åç§°ä¸º"b a d e f"
    ```
    

# 3.2 ç„¦ç‚¹ç®¡ç†ï¼ˆFocus Managementï¼‰

- HTML5å¢åŠ äº†è¾…åŠ©DOMç„¦ç‚¹ç®¡ç†çš„åŠŸèƒ½ï¼Œå®ƒå°±æ˜¯`activeElement` ï¼ŒMDNæç¤ºå®ƒå®šä¹‰åœ¨`[DocumentOrShadowRoot`](https://developer.mozilla.org/zh-CN/docs/Web/API/Document/activeElement) æ¥å£ä¸­ï¼Œç”¨æ¥è¿”å›å½“å‰åœ¨DOMæˆ–è€…shadow DOMæ ‘ä¸­å¤„äºèšç„¦çŠ¶æ€çš„å…ƒç´ èŠ‚ç‚¹
    - é¡µé¢åŠ è½½æ—¶ï¼Œå¯ä»¥é€šè¿‡ç”¨æˆ·è¾“å…¥ï¼ˆæŒ‰Tabé”®æˆ–ä»£ç ä¸­ä½¿ç”¨focus()æ–¹æ³•ï¼‰è®©æŸä¸ªå…ƒç´ è‡ªåŠ¨è·å¾—ç„¦ç‚¹
- åœ¨DOMè§„èŒƒä¸­ï¼Œç¡®å®æœ‰ä¸€ä¸ª**æ··å…¥**ï¼ˆ**mixin**ï¼‰æ¥å£****`[DocumentOrShadowRoot](https://dom.spec.whatwg.org/#documentorshadowroot)`** ,å®ƒçš„å®šä¹‰å¦‚ä¸‹
    
    ```jsx
    interface mixin DocumentOrShadowRoot {
    };
    Document includes DocumentOrShadowRoot;
    ShadowRoot includes DocumentOrShadowRoot;
    ```
    
    - `Document`å’Œ`ShadowRoot` å…±äº«`DocumentOrShadowRoot` å®šä¹‰çš„å±æ€§å’Œæ–¹æ³•ï¼Œä½†æ˜¯HTMLè§„èŒƒå¹¶æœªç»™å‡ºå…·ä½“çš„å±æ€§å’Œæ–¹æ³•
    - `Document` æ¥å£å’Œ`ShadowRoot` æ¥å£çš„IDLéƒ½æ²¡æœ‰ç›´æ¥å®šä¹‰`activeElement` ï¼Œè¯´æ˜äºŒè€…çš„`avitveElement` å±æ€§ç¡®å®æ˜¯æ··å…¥çš„
- åœ¨æœ€æ–°çš„HTMLè§„èŒƒä¸­ï¼Œå¯¹[`documentOrShadowRoot.activeElement`](https://html.spec.whatwg.org/multipage/interaction.html#dom-documentorshadowroot-activeelement-dev) æœ‰ä¸€ä¸ªæ ‡å‡†è§£é‡Šï¼Œå¹¶å®šä¹‰äº†å…·ä½“çš„[DocumentOrShadowRoot](https://html.spec.whatwg.org/#documentorshadowroot) æ¥å£ï¼Œå¦‚ä¸‹
    
    ```jsx
    partial interface mixin DocumentOrShadowRoot {
      readonly attribute Element? activeElement;
    };
    ```
    
- é»˜è®¤æƒ…å†µä¸‹ï¼Œ`document.activeElement` åœ¨é¡µé¢åˆšåŠ è½½å®Œä¹‹åä¼šè®¾ç½®ä¸º`document.body` ï¼Œè€Œåœ¨é¡µé¢å®Œå…¨åŠ è½½ä¹‹å‰ï¼Œ`document.activeElement` çš„å€¼ä¸º`null`
- å¯ä»¥é€šè¿‡`document.hasFocus()` æ–¹æ³•åˆ¤æ–­æ–‡æ¡£æ˜¯å¦æ‹¥æœ‰ç„¦ç‚¹ï¼Œ`hasFocus` ä»…åœ¨`Document` ç±»å‹ä¸­å­˜åœ¨ï¼Œä½†åœ¨DOMè§„èŒƒçš„[Documentæ¥å£](https://dom.spec.whatwg.org/#document) çš„IDLæ²¡æœ‰è¿›è¡Œå®šä¹‰ï¼Œè€Œåœ¨HTMLè§„èŒƒçš„****[Focus management APIs](https://html.spec.whatwg.org/multipage/interaction.html#focus-management-apis)** å’Œ[document](https://html.spec.whatwg.org/#document) object è¿›è¡Œäº†è¯´æ˜
    - ç¡®å®šæ–‡æ¡£æ˜¯å¦å…·æœ‰ç„¦ç‚¹ï¼Œå°±å¯ä»¥å¸®åŠ©ç¡®å®šç”¨æˆ·æ˜¯å¦åœ¨æ“ä½œé¡µé¢
    - `hasFocus()` å¯ä»¥æŸ¥è¯¢æ–‡æ¡£æ˜¯å¦è·å¾—äº†ç„¦ç‚¹ï¼Œ`activeElement` ç”¨äºç¡®å®šå“ªä¸ªå…ƒç´ æ‹¥æœ‰ç„¦ç‚¹
    - è¿™ä¸¤ä¸ªæ¥å£å¯¹äºä¿è¯Webåº”ç”¨ç¨‹åºçš„æ— éšœç¢ä½¿ç”¨éå¸¸é‡è¦ï¼Œæ— éšœç¢åœ°ä¸€ä¸ªé‡è¦æ–¹é¢å°±æ˜¯ç„¦ç‚¹ç®¡ç†ï¼Œè€Œèƒ½å¤Ÿç¡®å®šå“ªä¸ªå…ƒç´ å½“å‰æ‹¥æœ‰ç„¦ç‚¹æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è¿›æ­¥

```jsx
<body>
  <input type="text" />
  <script>
    console.log(document.hasFocus());
    const input = document.querySelector("input");
    input.focus();
    if (document.hasFocus()) {
      console.log(document.activeElement);
    }
  </script>
</body>
// æ‰“å°ç»“æœ
// true
// <input type="text">
```

# 3.3 HTMLDocumentæ‰©å±•

- HTML5æ‰©å±•äº†`HTMLDocument`ç±»å‹ï¼Œå¢åŠ äº†æ›´å¤šåŠŸèƒ½ï¼Œä¸å…¶ä»–HTML5å®šä¹‰çš„DOMæ‰©å±•ä¸€æ ·ï¼Œåœ¨æˆä¸ºæ ‡å‡†å‰äº‹å®ä¸Šå¤§éƒ¨åˆ†æµè§ˆå™¨éƒ½å®ç°äº†è¿™äº›ä¸“æœ‰æ‰©å±•

## 3.3.1 readyStateå±æ€§

- `readyState` å±æ€§æ˜¯IE4æœ€æ—©æ·»åŠ åˆ°`document` å¯¹è±¡ä¸Šçš„å±æ€§ï¼Œåæ¥å…¶ä»–æµè§ˆå™¨ä¹Ÿå‚ç…§è¿™ä¸ªæ”¯æŒè¿™ä¸ªå±æ€§ï¼Œæœ€ç»ˆHTML5å°†è¿™ä¸ªå±æ€§å†™å…¥äº†æ ‡å‡†
- `readyState` å±æ€§åœ¨HTMLè§„èŒƒçš„[Documentæ¥å£](https://html.spec.whatwg.org/#document) ä¸­å®šä¹‰ï¼Œå®ƒæ˜¯ä¸€ä¸ª[DocumentReadyState](https://html.spec.whatwg.org/#documentreadystate) æšä¸¾ç±»å‹ï¼Œå®šä¹‰å¦‚ä¸‹
    
    ```jsx
    enum DocumentReadyState { "loading", "interactive", "complete" };
    ```
    
    - [ ]  `loading` ï¼šè¡¨ç¤ºæ–‡æ¡£æ­£åœ¨åŠ è½½
    - [ ]  `complete` ï¼šè¡¨ç¤ºæ–‡æ¡£åŠ è½½å®Œæˆ
    - [ ]  `interactive` ï¼šè¡¨ç¤ºè§£æå®Œæˆï¼ˆ**finished parsing**ï¼‰ä½†ä»åœ¨åŠ è½½**å­èµ„æº**ï¼ˆ**subresources**ï¼‰
- å®é™…å¼€å‘ä¸­ï¼Œæœ€å¥½æŠŠ`document.readyState` å½“æˆä¸€ä¸ªæŒ‡ç¤ºå™¨ï¼Œä»¥åˆ¤æ–­æ–‡æ¡£æ˜¯å¦åŠ è½½å®Œæ¯•
    - åœ¨è¿™ä¸ªå±æ€§å¾—åˆ°å¹¿æ³›æ”¯æŒå‰ï¼Œé€šå¸¸ä¾èµ–`onload` äº‹ä»¶å¤„ç†ç¨‹åºè®¾ç½®ä¸€ä¸ªæ ‡è®°ï¼Œè¡¨ç¤ºæ–‡æ¡£åŠ è½½å®Œæ¯•
    - ä½†æ˜¯æœ‰äº†è¿™ä¸ª`readyState` å°±å¯ä»¥éšæ—¶æŸ¥è¯¢æ–‡æ¡£åŠ è½½çŠ¶æ€

```jsx
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>readyState</title>
  <script src="15.3.3.1 readyState.js"></script>
</head>
<body>
  <p>readyState</p>
</body>
```

```jsx
let interval = setInterval(() => {
  console.log(document.readyState);
});
setTimeout(() => {
  clearInterval(interval);
}, 500);
```

- æ‰“å°ç»“æœä¼šå› ä¸ºæµè§ˆå™¨åŠ è½½æ–‡æ¡£å’Œå¤–éƒ¨å¼•ç”¨è€Œæœ‰å˜åŒ–ï¼Œä¸‰ç§çŠ¶æ€éƒ½å¯èƒ½æ‰“å°å‡ºæ¥ï¼Œå¦‚ä¸‹
    
    ![readyState.png](3%20HTML5/readyState.png)
    

## 3.3.2 compatModeå±æ€§

- è‡ªä»IE6æä¾›äº†ä»¥**æ ‡å‡†æˆ–æ··æ‚æ¨¡å¼**æ¸²æŸ“é¡µé¢çš„èƒ½åŠ›ä¹‹åï¼Œæ£€æµ‹é¡µé¢æ¸²æŸ“æ¨¡å¼æˆä¸ºäº†ä¸€ä¸ªå¿…è¦çš„éœ€æ±‚ï¼›æ–‡æ¡£æ¨¡å¼ç›¸å…³çš„æŸ¥çœ‹ç¬¬äºŒç« çš„[3.æ–‡æ¡£æ¨¡å¼](../2%20HTML%E4%B8%AD%E7%9A%84JavaScript.md)
    - æ ‡å‡†æ¨¡å¼ï¼ˆstandard modeï¼‰
    - æ··æ‚æ¨¡å¼ï¼ˆquirks modeï¼‰
    - å‡†æ ‡å‡†æ¨¡å¼ï¼ˆalmost standard modeï¼‰
- IEä¸º`document`æ·»åŠ äº†`compatMode` å±æ€§ï¼Œè¿™ä¸ªå±æ€§å”¯ä¸€çš„ä»»åŠ¡æ˜¯æŒ‡ç¤ºæµè§ˆå™¨å½“å‰å¤„äºä»€ä¹ˆ**æ¸²æŸ“æ¨¡å¼**ï¼Œå®ƒåœ¨HTMLè§„èŒƒä¸­æ²¡æœ‰ç›¸å…³çš„ï¼Œåè€Œåœ¨DOMè§„èŒƒçš„[Documentæ¥å£](https://dom.spec.whatwg.org/#ref-for-dom-document-compatmode%E2%91%A0)çš„IDLä¸Šå®šä¹‰äº†è¯¥å±æ€§
    - æ–‡æ¡£æ¨¡å¼æ˜¯æ ‡å‡†æ¨¡å¼å’Œå‡†æ ‡å‡†æ¨¡å¼ï¼Œ`compatMode` å€¼æ˜¯â€BackCompatâ€ï¼Œæ–‡æ¡£æ¨¡å¼æ˜¯æ··æ‚æ¨¡å¼ï¼Œ`compatMode` å€¼æ˜¯â€œCSS1Compatâ€
        
        ```jsx
        <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
        <html lang="en">
          <head>
            <meta charset="UTF-8" />
            <meta http-equiv="X-UA-Compatible" content="IE=edge" />
            <meta name="viewport" content="width=device-width, initial-scale=1.0" />
            <title>compatMode</title>
          </head>
          <body>
            <p>å‡†æ ‡å‡†æ¨¡å¼</p>
            <script>
              console.log(document.compatMode); // CSS1Compat
            </script>
          </body>
        </html>
        ```
        
        ```jsx
        <!DOCTYPE html>
        <html lang="en">
          <head>
            <meta charset="UTF-8" />
            <meta http-equiv="X-UA-Compatible" content="IE=edge" />
            <meta name="viewport" content="width=device-width, initial-scale=1.0" />
            <title>compatMode</title>
          </head>
          <body>
            <p>æ ‡å‡†æ¨¡å¼</p>
            <script>
              console.log(document.compatMode); // CSS1Compat
            </script>
          </body>
        </html>
        ```
        
        ```jsx
        <html lang="en">
          <head>
            <meta charset="UTF-8" />
            <meta http-equiv="X-UA-Compatible" content="IE=edge" />
            <meta name="viewport" content="width=device-width, initial-scale=1.0" />
            <title>compatMode</title>
          </head>
          <body>
            <p>æ··æ‚æ¨¡å¼</p>
            <script>
              console.log(document.compatMode); // BackCompat
            </script>
          </body>
        </html>
        ```
        

## 3.3.3 headå±æ€§

- ä½œä¸ºå¯¹`document.body` ï¼ˆæŒ‡å‘æ–‡æ¡£çš„<body>å…ƒç´ ï¼‰çš„è¡¥å……ï¼ŒHTML5æ–°å¢äº†`document.head` å±æ€§ï¼ŒæŒ‡å‘æ–‡æ¡£çš„<head>å…ƒç´ ï¼Œ`head` å±æ€§åœ¨HTMLè§„èŒƒä¸­çš„[Document](https://html.spec.whatwg.org/#document) çš„IDLå®šä¹‰äº†
    
    ```jsx
    console.log(document.head);
    // æ‰“å°å‡ºheadå…ƒç´ 
    ```
    

## 3.4 å­—ç¬¦é›†å±æ€§ï¼ˆCharacter Set Propertiesï¼‰

- HTML5å¢åŠ äº†å‡ ä¸ªä¸æ–‡æ¡£å­—ç¬¦é›†æœ‰å…³çš„æ–°å±æ€§ï¼Œå…¶ä¸­ä¸€ä¸ªå°±æ˜¯`characterSet` å±æ€§ï¼Œè¡¨ç¤ºæ–‡æ¡£å®é™…ä½¿ç”¨çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥æŒ‡å®šæ–°å­—ç¬¦é›†
    - `characterSet` çš„é»˜è®¤å€¼æ˜¯~~â€œUTF-16â€~~ï¼ˆã€ŠJavaScripté«˜çº§ç¨‹åºè®¾è®¡ï¼ˆç¬¬4ç‰ˆï¼‰ã€‹åŸè¯ï¼‰
    - å¯ä»¥é€šè¿‡<meta>å…ƒç´ ï¼Œå“åº”å¤´ï¼Œä¿®æ”¹`characterSet`å±æ€§æ¥è®¾ç½®å­—ç¬¦é›†
    - DOMè§„èŒƒåœ¨[Document](https://dom.spec.whatwg.org/#document)æ¥å£ä¸­å®šä¹‰äº†`characterSet` å±æ€§
    
    ```jsx
    <!DOCTYPE html>
    <html lang="en">
      <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>å­—ç¬¦é›†</title>
      </head>
      <body>
        <script>
          console.log(document.characterSet, document.charset); // UTF-8 UTF-8
        </script>
      </body>
    </html>
    ```
    
- é€šè¿‡ä¸Šé¢çš„ä¾‹å­å¯ä»¥å‘ç°ï¼Œ`characterSet` æ‹¥æœ‰éæ³•åˆ«å`document.charset` ï¼Œä¸”é»˜è®¤å€¼ä¸ºâ€UTF-8â€œ
    - å…³äºå­—ç¬¦é›†å¯ä»¥æŸ¥çœ‹[10. Unicodeæ ‡å‡†ä¸­æ–‡ç¿»è¯‘](../../JavaScript%E5%B0%8F%E8%AE%A1/10%20Unicode%E6%A0%87%E5%87%86%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91.md)
    - å…³äº`document.characterSet` ï¼Œå‚è€ƒDOMè§„èŒƒï¼Œå®ƒè¿”å›ç¼–ç æ ¼å¼

## 3.5 è‡ªå®šä¹‰æ•°æ®å±æ€§

- HTML5å…è®¸ç»™å…ƒç´ æŒ‡å®šéæ ‡å‡†çš„å±æ€§ï¼Œä½†è¦ä½¿ç”¨å‰ç¼€`data-`ä»¥ä¾¿å‘Šè¯‰æµè§ˆå™¨ï¼Œè¿™äº›å±æ€§æ—¢**ä¸**åŒ…å«ä¸**æ¸²æŸ“æœ‰å…³çš„ä¿¡æ¯**ï¼Œä¹Ÿ**ä¸**åŒ…å«å…ƒç´ çš„**è¯­ä¹‰ä¿¡æ¯**
    
    ```jsx
    <div id="myDiv" data-appId="12345" data-myname="Nicholas"></div>
    ```
    
- å®šä¹‰äº†è‡ªå®šä¹‰å±æ€§åï¼Œå¯ä»¥é€šè¿‡å…ƒç´ çš„`dataset` å±æ€§æ¥è®¿é—®
    - `dataset`å±æ€§å®šä¹‰åœ¨ HTMLOrSVGElement ****æ··å…¥æ¥å£ä¸Šï¼Œè€ŒHTMLElementåŒ…å«å®ç°äº†HTMLOrSVGElement ï¼ŒHTMLè§„èŒƒä¸Šçš„[HTMLElement](https://html.spec.whatwg.org/multipage/dom.html#htmlelement)æ¥å£å’Œ[HTMLOrSVGElement](https://html.spec.whatwg.org/multipage/dom.html#htmlorsvgelement) æ¥å£
        
        ```jsx
        [Exposed=Window]
        interface HTMLElement : Element {
          [HTMLConstructor] constructor();
        
          // metadata attributes
          [CEReactions] attribute DOMString title;
          [CEReactions] attribute DOMString lang;
          [CEReactions] attribute boolean translate;
          [CEReactions] attribute DOMString dir;
        
          // user interaction
          [CEReactions] attribute (boolean or unrestricted double or DOMString)? hidden;
          [CEReactions] attribute boolean inert;
          undefined click();
          [CEReactions] attribute DOMString accessKey;
          readonly attribute DOMString accessKeyLabel;
          [CEReactions] attribute boolean draggable;
          [CEReactions] attribute boolean spellcheck;
          [CEReactions] attribute DOMString autocapitalize;
        
          [CEReactions] attribute [LegacyNullToEmptyString] DOMString innerText;
          [CEReactions] attribute [LegacyNullToEmptyString] DOMString outerText;
        
          ElementInternals attachInternals();
        };
        
        HTMLElement includes GlobalEventHandlers;
        HTMLElement includes ElementContentEditable;
        **HTMLElement includes HTMLOrSVGElement;**
        
        [Exposed=Window]
        interface HTMLUnknownElement : HTMLElement {
          // Note: intentionally no [HTMLConstructor]
        };
        
        interface mixin HTMLOrSVGElement {
          [SameObject] readonly attribute DOMStringMap **dataset**;
          attribute DOMString nonce; // intentionally no [CEReactions]
        
          [CEReactions] attribute boolean autofocus;
          [CEReactions] attribute long tabIndex;
          undefined focus(optional FocusOptions options = {});
          undefined blur();
        };
        ```
        
    - `dataset`å±æ€§æ˜¯ä¸€ä¸ª`DOMStringMap`çš„å®ä¾‹ï¼Œåœ¨HTMLè§„èŒƒä¸­ï¼Œè¿™ä¸ª[DOMStringMap](https://html.spec.whatwg.org/multipage/dom.html#domstringmap)æ¥å£å®šä¹‰å¦‚ä¸‹
        
        ```jsx
        [Exposed=Window,
         LegacyOverrideBuiltIns]
        interface DOMStringMap {
          getter DOMString (DOMString name);
          [CEReactions] setter undefined (DOMString name, DOMString value);
          [CEReactions] deleter undefined (DOMString name);
        };
        ```
        
        - [ ]  `getter` æ–¹æ³•ï¼šæ ¹æ®å…ƒç´ çš„è‡ªå®šä¹‰å±æ€§é”®è·å–å¯¹åº”å±æ€§å€¼
        - [ ]  `setter` æ–¹æ³•ï¼šè®¾ç½®è‡ªå®šä¹‰å±æ€§çš„é”®å€¼
        - [ ]  `deleter` æ–¹æ³•ï¼šåˆ é™¤å…ƒç´ çš„è‡ªå®šä¹‰å±æ€§é”®
        
        å¯¹äºHTMLæ¥è¯´ï¼Œå…ƒç´ çš„è‡ªå®šä¹‰å±æ€§é”®å°±æ˜¯data-åé¢çš„å­—ç¬¦ä¸²
        
        ```jsx
        <body>
          <div data-my-attribute="hello" data-attribute2="world">è‡ªå®šä¹‰å±æ€§</div>
          <script>
            const div = document.querySelector("div");
            console.log(div.dataset); // DOMStringMap
            console.log(div.dataset.myAttribute); // hello
            div.dataset.attribute2 = "mangwu";
            console.log(div.dataset.attribute2); // mangwu
            delete div.dataset.myAttribute;
            console.log(div.dataset); // DOMStringMap
          </script>
        </body>
        ```
        
        - DOMStringMapæ˜¯**å®æ—¶**çš„ï¼Œå®ƒæœ€ç»ˆåªæœ‰ä¸€ä¸ª**`attribute2`** å±æ€§ï¼Œå€¼ä¸ºâ€mangwuâ€
- è‡ªå®šä¹‰æ•°æ®å±æ€§éå¸¸é€‚åˆéœ€è¦ç»™å…ƒç´ é™„åŠ æŸäº›æ•°æ®çš„åœºæ™¯ï¼Œæ¯”å¦‚**é“¾æ¥è¿½è¸ª**å’Œåœ¨èšåˆåº”ç”¨ç¨‹åºä¸­æ ‡è¯†é¡µé¢çš„ä¸åŒéƒ¨åˆ†ï¼Œå¦å¤–ï¼Œå•åº”ç”¨ç¨‹åºæ¡†æ¶ä¹Ÿéå¸¸å¤šåœ°ä½¿ç”¨äº†è‡ªå®šä¹‰æ•°æ®å±æ€§

## 3.6 æ’å…¥æ ‡è®°ï¼ˆMarkup Insertionï¼‰

- DOMè™½ç„¶å·²ç»ä¸ºæ“ä½œèŠ‚ç‚¹æä¾›äº†å¾ˆå¤šAPIï¼Œä½†å‘æ–‡æ¡£ä¸­ä¸€æ¬¡æ€§æ’å…¥å¤§é‡HTMLæ—¶è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„
    - ç›´æ¥æ’å…¥ä¸€ä¸ªHTMLå­—ç¬¦ä¸²è¦æ¯”ä¸€ä¸ªä¸ªåˆ›å»ºèŠ‚ç‚¹å†æ’å…¥è¦æ–¹ä¾¿çš„å¤š
    - HTML5å·²ç»é€šè¿‡ä»¥ä¸‹DOMæ‰©å±•å°†è¿™ç§èƒ½åŠ›æ ‡å‡†åŒ–äº†

### 3.6.1 innerHTMLå±æ€§

- `innerHTML`å±æ€§ ä¼šè¿”å›å…ƒç´ æ‰€æœ‰åä»£çš„HTMLå­—ç¬¦ä¸²ï¼ŒåŒ…æ‹¬å…ƒç´ ã€æ³¨é‡Šå’Œæ–‡æœ¬èŠ‚ç‚¹
    - å†™å…¥`innerHTML` æ—¶ï¼Œä¼šæ ¹æ®æä¾›çš„å­—ç¬¦ä¸²å€¼ä»¥æ–°çš„DOMå­æ ‘æ›¿ä»£å…ƒç´ ä¸­åŸæ¥åŒ…å«çš„æ‰€æœ‰èŠ‚ç‚¹
    - [DOM Parsing and Serialization](https://w3c.github.io/DOM-Parsing/#dom-innerhtml-innerhtml) è§„èŒƒå®šä¹‰äº†[InnerHTML](https://w3c.github.io/DOM-Parsing/#dom-innerhtml-innerhtml)æ··å…¥æ¥å£ï¼ŒElement æ¥å£åŒ…å«äº†InnerHTMLæ¥å£ï¼Œå¦‚ä¸‹
        
        ```jsx
        interface mixin InnerHTML {
          [CEReactions] attribute [LegacyNullToEmptyString] DOMString innerHTML;
        };
        
        **Element includes InnerHTML;**
        ShadowRoot includes InnerHTML;
        ```
        
    - `innerHTML` å±æ€§è¿”å›çš„æ–‡æœ¬å†…å®¹ä¼šå› æµè§ˆå™¨å®ç°è€Œä¸åŒ
        - IEå’ŒOperaä¼šæŠŠæ‰€æœ‰å…ƒç´ æ ‡ç­¾è½¬æ¢ä¸ºå¤§å†™
        - Safariã€Chromeå’ŒFirefoxåˆ™ä¼šæŒ‰ç…§æ–‡æ¡£æºä»£ç çš„æ ¼å¼è¿”å›ï¼ŒåŒ…å«ç©ºæ ¼å’Œç¼©è¿›
        - ä¸è¦æŒ‡æœ›ä¸åŒçš„æµè§ˆå™¨çš„innerHTMLä¼šè¿”å›å®Œå…¨ä¸€æ ·çš„å€¼
    - åœ¨å†™å…¥æ¨¡å¼ä¸‹ï¼Œèµ‹ç»™`innerHTML` å±æ€§çš„å€¼ä¼šè¢«è§£æä¸ºDOMå­æ ‘ï¼Œå¹¶æ›¿ä»£å…ƒç´ ä¹‹å‰çš„æ‰€æœ‰èŠ‚ç‚¹
        - æ‰€èµ‹çš„å€¼é»˜è®¤ä»¥HTMLæ ¼å¼è¯†åˆ«ï¼Œå…¶ä¸­çš„æ‰€æœ‰æ ‡ç­¾éƒ½ä¼šä»¥æµè§ˆå™¨å¤„ç†HTMLçš„æ–¹å¼è½¬æ¢ä¸ºå…ƒç´ 
        - å¦‚æœèµ‹å€¼ä¸­ä¸åŒ…å«ä»»ä½•HTMLæ ‡ç­¾ï¼Œåˆ™ç›´æ¥ç”Ÿæˆä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹
    - å¦‚æœç»™`innerHTML`è®¾ç½®åŒ…å«HTMLï¼ˆæ ‡ç­¾ï¼‰çš„å­—ç¬¦ä¸²æ—¶ï¼Œå®ƒåœ¨å®é™…æ¸²æŸ“æ—¶ä¼šè¿›è¡Œè½¬ä¹‰å¤„ç†è¯†åˆ«
    
    ```jsx
    <body>
      <ul>
        <li>item 1</li>
        <li>item 2</li>
        <li>item 3</li>
      </ul>
      <script>
        const ul = document.querySelector("ul");
        console.log(ul.innerHTML);
        ul.innerHTML = "<li>item4</li>"
        console.log(ul.innerHTML);
      </script>
    </body>
    ```
    
    ![innerHTML.png](3%20HTML5/innerHTML.png)
    
    - å¯ä»¥çœ‹åˆ°å¦‚ä¸Šçš„`innerHTML` ç›´æ¥æ‰“å°å‡ºæ¥æ˜¯æœ‰æ¢è¡Œï¼Œç©ºæ ¼çš„

### 3.6.2 æ—§IEä¸­çš„innerHTML

- åœ¨æ‰€æœ‰ç°ä»£æµè§ˆå™¨ä¸­ï¼Œé€šè¿‡innerHTMLæ’å…¥çš„<script>æ ‡ç­¾æ˜¯ä¸ä¼šæ‰§è¡Œçš„çš„
- è€Œåœ¨IE8åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œåªè¦è¿™æ ·æ’å…¥<script>å…ƒç´ æŒ‡å®šäº†deferå±æ€§ï¼Œä¸”<script>ä¹‹å‰æ˜¯â€œå—æ§å…ƒç´ â€ï¼ˆscoped elementï¼‰ï¼Œé‚£å°±æ˜¯å¯ä»¥æ‰§è¡Œçš„
    - <script>ï¼Œ<style>å…ƒç´ å’Œæ³¨é‡Šå…ƒç´ éƒ½æ˜¯â€œéå—æ§å…ƒç´ ï¼ˆNoScope Elementï¼‰â€ï¼Œä¹Ÿå°±æ˜¯åœ¨é¡µé¢ä¸Šçœ‹ä¸åˆ°å®ƒä»¬
    - IEä¼šæŠŠ`innerHTML`ä¸­ä»éå—æ§å…ƒç´ å¼€å§‹çš„å†…å®¹éƒ½åˆ æ‰
    
    ```jsx
    <body>
      <script>
        document.body.innerHTML = "<script defer>console.log('hi!')<\/script>";
      </script>
    </body>
    ```
    
    - å¦‚æœæƒ³è¦æ—§ç‰ˆæœ¬IEä¸­æ‰§è¡Œä¸´æ—¶æ’å…¥çš„scriptï¼Œåªéœ€è¦åœ¨å‰é¢æ·»åŠ å—æ§å…ƒç´ å°±è¡Œï¼Œå¦‚ä¸‹
    
    ```jsx
    document.body.innerHTML = "_<script>console.log('hi!')<\/script>";
    document.body.innerHTML = "<div>&nbsp;</div><script>console.log('hi!')<\/script>";
    document.body.innerHTML =
            "<input type='hidden'><script>console.log('hi!')<\/script>";
    ```
    
    - ç¬¬ä¸‰è¡Œä¼šæ˜¯æœ€å¥½çš„æ–¹æ¡ˆï¼Œå› ä¸ºä¸ä¼šæœ‰å—æ§å…ƒç´ å†…å®¹æ˜¾ç¤º
- åœ¨IEä¸­ï¼Œé€šè¿‡innerHTMLæ’å…¥<style>ä¹Ÿä¼šæœ‰ç±»ä¼¼çš„é—®é¢˜ï¼Œå› ä¸ºåœ¨IE8ä¸­<style>ä¹Ÿè¢«è®¤ä¸ºæ˜¯éå—æ§å…ƒç´ ï¼›ç°ä»£æµè§ˆå™¨ä¸­é€šè¿‡innerHTMLå¯ä»¥æˆåŠŸè®¾ç½®æ ·å¼
    
    ```jsx
    document.body.innerHTML =
      "<style>body { background-color: red; }<\/style>";
    document.body.innerHTML =
      "<input type='hidden'><style>body { background-color: red; }<\/style>";
    ```
    
    - åœ¨ç°ä»£æµè§ˆå™¨ä¸­ä¸¤ä¸ªè¯­å¥çš„styleéƒ½ä¼šç”Ÿæ•ˆï¼Œä½†æ˜¯åœ¨IE8åŠä»¥ä¸‹ç‰ˆæœ¬åªæœ‰ç¬¬äºŒä¸ªä¼šç”Ÿæ•ˆ

<aside>
ğŸ’¡ æ³¨æ„ï¼šFirefoxåœ¨å†…å®¹ç±»å‹ä¸ºapplication/xhtml+xmlçš„XHTMLæ–‡æ¡£ä¸­å¯¹innerHTMLæ›´åŠ ä¸¥æ ¼ã€‚åœ¨XHTMLæ–‡æ¡£ä¸­ä½¿ç”¨innerHTMLï¼Œå¿…é¡»ä½¿ç”¨æ ¼å¼è‰¯å¥½çš„XHTMLä»£ç ã€‚å¦åˆ™ï¼Œåœ¨Firefoxä¼šé™é»˜å¤±è´¥

</aside>

### 3.6.3 outerHTMLå±æ€§

- è¯»å–outerHTMLå±æ€§æ—¶ï¼Œä¼šè¿”å›è°ƒç”¨å®ƒçš„å…ƒç´ ï¼ˆåŠæ‰€æœ‰åä»£å…ƒç´ ï¼‰çš„HTMLå­—ç¬¦ä¸²
    - åœ¨å†™å…¥outerHTMLå±æ€§æ—¶ï¼Œè°ƒç”¨å®ƒçš„å…ƒç´ ä¼šè¢«ä¼ å…¥çš„HTMLå­—ç¬¦ä¸²ç»è§£é‡Šåç”Ÿæˆçš„DOMå­æ ‘å–ä»£
    
    ```jsx
    <body>
      <div class="content">
        <p>This is a <strong>paragraph</strong> with a list following it.</p>
        <ul>
          <li>Item 1</li>
          <li>Item 2</li>
          <li>Item 3</li>
        </ul>
      </div>
      <script>
        const div = document.querySelector("DIV");
        console.log(div.innerHTML);
        console.log(div.outerHTML);
      </script>
    </body>
    ```
    
    ![outerHTML.png](3%20HTML5/outerHTML.png)
    
    - `outerHTML` å±æ€§çš„è¿”å›å€¼ä¸`innerHTML`çš„åŒºåˆ«åœ¨äºå®ƒåŒ…å«è°ƒç”¨å…ƒç´ èŠ‚ç‚¹è‡ªèº«
- ä¿®æ”¹`outerHTML`å±æ€§ä¼šè¿å¸¦å…ƒç´ èŠ‚ç‚¹è¢«ä¿®æ”¹ï¼Œå¦‚ä¸‹
    
    ```jsx
    <body>
      <div>
        <p>Hello, world!</p>
      </div>
      <script>
        const div = document.querySelector("div");
        div.outerHTML = "<p>Hello, mangwu</p>";
      </script>
    </body>
    ```
    
    <div>èŠ‚ç‚¹çš„outerHTMLè¢«ä¿®æ”¹ä¸ºä¸€ä¸ªpèŠ‚ç‚¹ï¼Œå¦‚ä¸‹
    
    ![outerHTML2.png](3%20HTML5/outerHTML2.png)
    

### 3.6.4 insertAdjacentHTML()ä¸insertAdjacentText()

- å…³äºæ’å…¥æ ‡ç­¾çš„æœ€åä¸¤ä¸ªæ–°å¢æ–¹æ³•æ˜¯insertAdjacentHTML()å’ŒinsertAdjacentText()
    - è¿™ä¸¤ä¸ªæ–¹æ³•æœ€æ—©æºäºIE
    - å®ƒä»¬éƒ½æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šè¦æ’å…¥æ ‡è®°çš„ä½ç½®å’Œè¦æ’å…¥çš„HTMLæˆ–æ–‡æœ¬
    - ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰å¿…é¡»æ˜¯ä¸‹åˆ—å€¼å…¶ä¸­ä¸€ä¸ª
        - [ ]  â€œbeforebeginâ€, æ’å…¥å½“å‰å…ƒç´ å‰é¢ï¼Œä½œä¸ºå‰ä¸€ä¸ªåŒèƒèŠ‚ç‚¹
        - [ ]  â€œafterbeginâ€ï¼Œæ’å…¥å½“å‰å…ƒç´ å†…éƒ¨ï¼Œä½œä¸ºæ–°çš„å­èŠ‚ç‚¹æˆ–æ”¾åœ¨ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹å‰é¢
        - [ ]  â€œbeforeendâ€ï¼Œæ’å…¥å½“å‰å…ƒç´ å†…éƒ¨ï¼Œä½œä¸ºæ–°çš„å­èŠ‚ç‚¹æˆ–æ”¾åœ¨æœ€åä¸€ä¸ªå­èŠ‚ç‚¹åé¢
        - [ ]  â€œafterendâ€ï¼Œæ’å…¥å½“å‰å…ƒç´ åé¢ï¼Œä½œä¸ºä¸‹ä¸€ä¸ªåŒèƒèŠ‚ç‚¹
    - ç¬¬äºŒä¸ªå‚æ•°ä¼šä½œä¸ºHTMLå­—ç¬¦ä¸²è§£æï¼ˆä¸innerHTMLå’ŒouterHTMLç›¸åŒï¼‰ï¼Œæˆ–ä½œä¸ºçº¯æ–‡æœ¬è§£æï¼ˆä¸innerTextå’ŒouterTextç›¸åŒï¼‰ï¼Œå¦‚æœæ˜¯HTMLï¼Œåˆ™ä¼šåœ¨è§£æå‡ºé”™æ—¶æŠ›å‡ºé”™è¯¯ã€‚
- [Element](https://dom.spec.whatwg.org/#element) æ¥å£æ‰©å±•äº†è¿™ä¸¤ä¸ªæ¥å£ï¼Œ`insertAdjacentHTML`åœ¨[DOM-Paring](https://w3c.github.io/DOM-Parsing/#dom-element-insertadjacenthtml) è§„èŒƒä¸­å®šä¹‰äº†ï¼Œ`insertAdjacentText` åœ¨[DOM](https://dom.spec.whatwg.org/#dom-element-insertadjacenttext)è§„èŒƒä¸­æœ‰æåŠ
    
    ```jsx
    <body>
        <div class="content">
          <div class="sss">sss</div>
          <div class="kkk">kkk</div>
          <div class="mmm">mmm</div>
        </div>
        <script>
          const content = document.querySelector(".content");
          // ä½œä¸ºå‰ä¸€ä¸ªåŒèƒèŠ‚ç‚¹æ’å…¥
          content.insertAdjacentHTML("beforebegin", "<p>Hello world!</p>");
          content.insertAdjacentText("beforebegin", "Hello world!");
    
          // ä½œä¸ºç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹æ’å…¥
          content.insertAdjacentHTML("afterbegin", "<p>Hello world!2</p>");
          content.insertAdjacentText("afterbegin", "Hello world!2");
    
          // ä½œä¸ºæœ€åä¸€ä¸ªå­èŠ‚ç‚¹æ’å…¥
          content.insertAdjacentHTML("beforeend", "<p>Hello world!3</p>");
          content.insertAdjacentText("beforeend", "Hello world!3");
    
          // ä½œä¸ºä¸‹ä¸€ä¸ªåŒèƒèŠ‚ç‚¹æ’å…¥
          content.insertAdjacentHTML("afterend", "<p>Hello world!4</p>");
          content.insertAdjacentText("afterend", "Hello world!4");
    
        </script>
      </body>
    ```
    
    ![insert.png](3%20HTML5/insert.png)
    

<aside>
ğŸ’¡ æ³¨æ„ï¼Œåœ¨DOMè§„åˆ™ä¸­è¿˜å®šä¹‰äº†ä¸€ä¸ª**[insertAdjacentElement](https://dom.spec.whatwg.org/#dom-element-insertadjacentelement)** æ–¹æ³•ï¼Œç”¨äºç»™èŠ‚ç‚¹æ’å…¥å…ƒç´ èŠ‚ç‚¹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å’Œä¸Šé¢ä¸¤ä¸ªæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å€¼ä¸€æ ·ï¼Œä½†æ˜¯ç¬¬äºŒä¸ªå‚æ•°åº”è¯¥æ˜¯ä¸€ä¸ªå…ƒç´ èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯HTMLæ ¼å¼æ–‡æœ¬æˆ–æ–‡æœ¬å­—ç¬¦ä¸²ï¼›ã€ŠJavaScripté«˜çº§ç¨‹åºè®¾è®¡ï¼ˆç¬¬4ç‰ˆï¼‰ã€‹æ²¡æœ‰ä»‹ç»å®ƒçš„åŸå› æ˜¯å®ƒæ˜¯**éæ³•ï¼ˆlegacyï¼‰**çš„ï¼ˆå®é™…ä¸ŠinsertAdjacentTextä¹Ÿæ˜¯éæ³•çš„æ–¹æ³•ï¼‰

</aside>

### 3.6.5 å†…å­˜ä¸æ€§èƒ½é—®é¢˜ï¼ˆMemory and Performance Issuesï¼‰

- ä½¿ç”¨æœ¬èŠ‚[3.6 æ’å…¥æ ‡è®°ï¼ˆMarkup Insertionï¼‰](3%20HTML5.md) ä»‹ç»çš„æ–¹æ³•å’Œå±æ€§æ›¿æ¢èŠ‚ç‚¹å¯èƒ½åœ¨æµè§ˆå™¨ï¼ˆç‰¹åˆ«æ˜¯IEï¼‰ä¸­å¯èƒ½å¯¼è‡´å†…å­˜é—®é¢˜
    - å¦‚æœè¢«ç§»é™¤å­æ ‘å…ƒç´ ä¸­ä¹‹å‰æœ‰å…³è”çš„äº‹ä»¶å¤„ç†ç¨‹åºæˆ–å…¶å®ƒJavaScriptå¯¹è±¡ï¼ˆä½œä¸ºå…ƒç´ çš„å±æ€§ï¼‰ï¼Œé‚£ä¹ˆå®ƒä»¬ä¹‹é—´çš„ç»‘å®šå…³ç³»ä¼šæ»ç•™åœ¨å†…å­˜ä¸­ï¼ˆå†…å­˜æ³„æ¼ï¼‰
    - å¹¶ä¸”é¢‘ç¹ä½¿ç”¨æ’å…¥æ ‡è®°çš„å±æ€§å’Œæ–¹æ³•ï¼Œé¡µé¢å ç”¨çš„å†…å­˜å°±ä¼šæŒç»­æ”€å‡ï¼Œåœ¨æ‰‹åŠ¨ä½¿ç”¨`innerHTML` ã€`outerHTML` ã€`insertAdjacentHTML()` ä¹‹å‰ï¼Œæœ€å¥½æ‰‹åŠ¨åˆ é™¤è¦è¢«æ›¿æ¢çš„å…ƒç´ ä¸Šå…³è”çš„äº‹ä»¶å¤„ç†ç¨‹åºå’ŒJavaScriptå¯¹è±¡
- ä¸€èˆ¬è€Œè¨€ï¼Œæ’å…¥å¤§é‡æ–°HTMLä½¿ç”¨innerHTMLæ¯”ä½¿ç”¨å¤šæ¬¡DOMæ“ä½œåˆ›å»ºèŠ‚ç‚¹å†æ’å…¥æ¥çš„æ›´ä¾¿æ·
    - å› ä¸ºHTML**è§£æå™¨**ï¼ˆ**parser**ï¼‰ä¼šè§£æè®¾ç½®ç»™innerHTMLï¼ˆæˆ–outerHTMLï¼‰çš„å€¼
    - è§£æå™¨åœ¨æµè§ˆå™¨ä¸­æ˜¯åº•å±‚ä»£ç ï¼ˆé€šå¸¸æ˜¯C++ä»£ç ï¼‰ï¼Œæ¯”JavaScriptå¿«å¾—å¤š
- ä¸è¿‡HTMLè§£æå™¨çš„æ„å»ºå’Œè§£æ„ï¼ˆcreation and destructionï¼‰ä¹Ÿä¸æ˜¯æ²¡æœ‰ä»£ä»·ï¼Œå› æ­¤æœ€å¥½é™åˆ¶ä½¿ç”¨`innerHTML`å’Œ`outerHTML` ,å¦‚ä¸‹ä»£ç åˆ›å»ºä¸€äº›åˆ—è¡¨é¡¹å°±æ˜¯è¿”ä¾‹
    
    ```jsx
    <body>
      <ul></ul>
      <script>
        const values = ["hello", "message", "mangwu", "hms", "AliOs", "afraid"];
        const ul = document.querySelector("ul");
        for (const value of values) {
          ul.innerHTML += `<li>${value}</li>`;
        }
      </script>
    </body>
    ```
    
    - è¿™æ®µä»£ç æ•ˆç‡ä½ä¸‹ï¼Œå› ä¸ºæ¯æ¬¡è¿­ä»£éƒ½è¦è®¾ç½®ä¸€æ¬¡innerHTML
    - ä¸ä»…å¦‚æ­¤ï¼Œæ¯æ¬¡å¾ªç¯è¿˜è¦å…ˆè¯»å–`innerHTML` ï¼Œå¤šæ¬¡ä½¿ç”¨HTMLè§£æå™¨çš„æ„å»ºå’Œè§£æ„ï¼Œä»£ä»·ä¼šå¢åŠ 
- è§£å†³æ–¹æ¡ˆä¸ºå…ˆé€šè¿‡å¾ªç¯æ„å»ºä¸€ä¸ªç‹¬ç«‹çš„å­—ç¬¦ä¸²ï¼Œæœ€åä¸€æ¬¡æ€§æŠŠç”Ÿæˆçš„å­—ç¬¦ä¸²èµ‹å€¼ç»™`innerHTML` ï¼Œå¦‚ä¸‹
    
    ```jsx
    let itemsHTML = "";
    for (const value of values) {
      itemsHTML += `<li>${value}</li>`;
    }
    ul.innerHTML = itemsHTML;
    ```
    

### 3.6.6 è·¨ç«™ç‚¹è„šæœ¬ï¼ˆ**Cross-Site Scripting Considerations**ï¼‰

- å°½ç®¡`innerHTML`ä¸ä¼šæ‰§è¡Œè‡ªå·±åˆ›å»ºçš„<script>æ ‡ç­¾ï¼Œä½†ä»ç„¶å‘æ¶æ„ç”¨æˆ·æš´éœ²äº†å¾ˆå¤§çš„æ”»å‡»é¢ï¼Œå› ä¸ºé€šè¿‡å®ƒå¯ä»¥æ¯«ä¸è´¹åŠ›åœ°åˆ›å»ºå¹¶æ‰§è¡Œ`onclick`ä¹‹ç±»çš„å±æ€§
- å¦‚æœé¡µé¢è¦ä½¿ç”¨ç”¨æˆ·æä¾›çš„ä¿¡æ¯ï¼Œä¸å»ºè®®ä½¿ç”¨`innerHTML`
    - ä¸ä½¿ç”¨innerHTMLè·å¾—çš„æ–¹ä¾¿ç›¸æ¯”ï¼Œé˜²æ­¢XSSæ”»å‡»æ›´è®©äººå¤´ç–¼
    - æ­¤æ—¶ä¸€å®šè¦éš”ç¦»è¦æ’å…¥çš„æ•°æ®ï¼Œåœ¨æ’å…¥é¡µé¢å‰å¿…é¡»æ¯«ä¸çŠ¹è±«åœ°ä½¿ç”¨ç›¸åŒçš„åº“å¯¹å®ƒä»¬è¿›è¡Œè½¬ä¹‰

### 3.6.7 scrollIntoView()

- DOMè§„èŒƒä¸­æ²¡æœ‰æ¶‰åŠçš„ä¸€ä¸ªé—®é¢˜æ˜¯å¦‚ä½•æ»šåŠ¨é¡µé¢ä¸­çš„æŸä¸ªåŒºåŸŸ
    - ä¸åŒæµè§ˆå™¨å®ç°äº†ä¸åŒçš„æ§åˆ¶æ»šåŠ¨çš„æ–¹å¼
    - åœ¨æ‰€æœ‰è¿™äº›ä¸“æœ‰æ–¹æ³•ä¸­ï¼ŒHTML5é€‰æ‹©äº†æ ‡å‡†åŒ–`scrollIntoView()`
- `scrollIntoView` æ–¹æ³•å®šä¹‰åœ¨[CSSOM View Module](https://w3c.github.io/csswg-drafts/cssom-view/#dom-element-scrollintoview) æ ‡å‡†ä¸­ï¼Œ`scrollIntoView`æ–¹æ³•å®šä¹‰åœ¨[Elementçš„æ‰©å±•æ¥å£](https://w3c.github.io/csswg-drafts/cssom-view/#extension-to-the-element-interface)ä¸­ï¼Œåœ¨æœ‰è¯¦ç»†çš„ä»‹ç»
    
    ```jsx
    enum ScrollBehavior { "auto", "smooth" };
    
    dictionary ScrollOptions {
        ScrollBehavior behavior = "auto";
    };
    
    enum ScrollLogicalPosition { "start", "center", "end", "nearest" };
    dictionary ScrollIntoViewOptions : ScrollOptions {
      ScrollLogicalPosition block = "start";
      ScrollLogicalPosition inline = "nearest";
    };
    
    dictionary CheckVisibilityOptions {
        boolean checkOpacity = false;
        boolean checkVisibilityCSS = false;
    };
    partial interface Element {
      DOMRectList getClientRects();
      [NewObject] DOMRect getBoundingClientRect();
    
      boolean checkVisibility(optional CheckVisibilityOptions options = {});
    
      **undefined scrollIntoView(optional (boolean or ScrollIntoViewOptions) arg = {});**
      undefined scroll(optional ScrollToOptions options = {});
      undefined scroll(unrestricted double x, unrestricted double y);
      undefined scrollTo(optional ScrollToOptions options = {});
      undefined scrollTo(unrestricted double x, unrestricted double y);
      undefined scrollBy(optional ScrollToOptions options = {});
      undefined scrollBy(unrestricted double x, unrestricted double y);
      attribute unrestricted double scrollTop;
      attribute unrestricted double scrollLeft;
      readonly attribute long scrollWidth;
      readonly attribute long scrollHeight;
      readonly attribute long clientTop;
      readonly attribute long clientLeft;
      readonly attribute long clientWidth;
      readonly attribute long clientHeight;
    };
    ```
    
    - [ ]  `alignToTop` æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå¸ƒå°”å€¼ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°æœ‰å¦‚ä¸‹å«ä¹‰
        - `true` ï¼šçª—å£æ»šåŠ¨åå…ƒç´ çš„é¡¶éƒ¨ä¸è§†å£é¡¶éƒ¨å¯¹é½
        - `false` ï¼šçª—å£æ»šåŠ¨åå…ƒç´ çš„åº•éƒ¨ä¸è§†å£åº•éƒ¨å¯¹é½
    - [ ]  `scrollIntoViewOptions` æ˜¯ä¸€ä¸ªé€‰é¡¹å¯¹è±¡ï¼Œå±æ€§å’Œå±æ€§å€¼æœ‰å¦‚ä¸‹é€‰æ‹©
        - `behavior` ï¼šå®šä¹‰è¿‡æ¸¡åŠ¨ç”»ï¼Œå¯å–å€¼ä¸ºâ€smoothâ€ï¼Œâ€autoâ€ï¼Œé»˜è®¤ä¸ºâ€autoâ€
        - `block` ï¼šå®šä¹‰å‚ç›´æ–¹å‘çš„å¯¹é½ï¼Œå¯å–çš„å€¼ä¸ºâ€œstartâ€˜ã€â€centerâ€ã€â€endâ€å’Œâ€nearestâ€ï¼Œé»˜è®¤ä¸ºâ€startâ€
        - `inline` ï¼šå®šä¹‰æ°´å¹³æ–¹å‘çš„å¯¹é½ï¼Œå¯å–çš„å€¼ä¸ºâ€startâ€œã€â€centerâ€ã€â€endâ€å’Œâ€nearestâ€ï¼Œé»˜è®¤ä¸ºâ€nearsetâ€
    - [ ]  ä¸ä¼ é€’å‚æ•°ç­‰åŒäº`alignToTop` ä¸º`true`
- è¿™ä¸ªæ–¹æ³•ç”¨çš„å¾ˆå°‘ï¼ŒMDNç”šè‡³éƒ½æ²¡æœ‰å¯è§†åŒ–çš„ä¾‹å­ï¼Œæ€»çš„æ¥è¯´ï¼Œå®ƒå°±æ˜¯ç”¨æ¥è®¾ç½®çˆ¶çº§å®¹å™¨ä¸­çš„å­å…ƒç´ å‡ºç°åœ¨è§†å£æ—¶çš„è¡Œä¸ºï¼ˆå¯¹é½æ–¹å¼ï¼ŒåŠ¨ç”»ç­‰ï¼‰,ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­
    
    ```jsx
    <input type="submit" value="æäº¤" />
    
    <p></p>
    	<div class="wrapper">
    	  <div class="special">JavaScript</div>
    	</div>
    <p></p>
    ```
    
    ```jsx
    let el = document.querySelector(".special");
    const submit = document.querySelector("input[type='submit']");
    
    // argæ˜¯é¡µé¢é€‰æ‹©çš„ä¼ é€’çš„å‚æ•°ï¼Œå¯ä»¥æŸ¥çœ‹å…·ä½“ä»£ç 
    submit.addEventListener("click", () => {
      if (arg.type === "arg1") {
        el.scrollIntoView(arg.value1);
      } else {
        el.scrollIntoView(arg.value2);
      }
    });
    ```
    
     å®Œæ•´ä»£ç æŸ¥çœ‹[github](https://github.com/mangwu/javascript/blob/master/ProfessionalJavaScriptForWebDeveloper4/ch15%20-%20DOM%20Extensions/15.3%20HTML5/15.3.6%20Insertion%20Markup/15.3.6.6%20scrollIntoView.html)
    
    ![scrollIntoView.gif](3%20HTML5/scrollIntoView.gif)
    
    - ä¸åŒçš„å‚æ•°æœ‰ä¸åŒçš„æ•ˆæœ
-